$(window).load(function(){function a(e){var t=null;if(document.cookie&&document.cookie!=""){var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=jQuery.trim(n[r]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}function f(e,t,n,i,s,u,a,f,l,c,h){var e=e;var t=t;var n=n;var i=i;var p=s;var v={p:a,b:u};var m="/public/img/device/"+i+".svg";var f=f;var l=l+o.GetGapX();var c=c+o.GetGapY();var g={x:55,y:50};var h=h;this.Draw=function(){f.image(m,l,c,100,100).scale(h.x,h.y).mouseover(function(){$("#d").html('<table><tr><td><label class="label">Hostname : </label></td><td>'+p+'</td></tr><tr><td><label class="label">IP : </label></td><td id="aip">'+e+'</td></tr><tr><td><label class="label">MAC : </label></td></td><td>'+t+'</td></tr><tr><td><label class="label">OS : </label></td></td><td><button id="dos" class="btn btn-inverse" type="button">Détection d\'OS</button></td></tr><tr><td><label class="label">Bande passante : </label></td></td><td> '+v.p+"% ("+v.b+" kb/s)</td</tr></table>");$("#dos").on("click",function(){if(available.os==0){available.os=1;$("#inf").html('<div class="container alert alert-info">L\'os finger printing est lancée. Cette action peut prendre un certain temps</div>');$("#os").html();$.ajax({type:"post",headers:{"X-CSRFToken":r},data:{ip:$("#aip").html()},url:"/os/",success:function(e){d=JSON.parse(e);$("#os").html(d.rep);available.os=0;if(d.success=1)$("#inf").html('<div class="container alert alert-info"><button type="button" class="close" data-dismiss="alert">×</button>La fonctionnalité d\'os finger printing est à nouveau disponible</div>');else $("#inf").html('<div class="container alert alert-warning"><button type="button" class="close" data-dismiss="alert">×</button>Un problème est survenu ... <br />Mais la fonctionnalité d\'os finger printing est à nouveau disponible</div>')},error:function(){alert("La requête n'a pas abouti");available.os=0}})}else{$("#inf").html('<div class="container alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>La fonctionnalité d\'os finger printing n\'est pas encore disponible</div>')}})}).drag(function(){return false})};this.GetX=function(){return l+g.x};this.GetY=function(){return c+g.y};this.GetIp=function(){return e};this.GetBw=function(){return v};this.GetHostname=function(){return p};this.SetBw=function(e,t){v.percent=e;v.mega=t};this.SetMac=function(e){t=e}}function l(r){var s=60;var u={x:$("#main").width()/2-s,y:$("#main").height()/2-s};var a=500+r.net.length+500*.25;var l=u.x;var c=u.y;var h;var p=0;var d=360/r.net.length+.5;i=[];i[0]=new f(r.gw,"8c:89:a5:a3:ad:1f","Linux","router","Itinet",0,0,e,l/o.GetScaleConnector(),c/o.GetScaleConnector(),{x:.6+o.GetScaleDevice(),y:.6+o.GetScaleDevice()});var v={x:i[0].GetX(),y:i[0].GetY()};var m='<table class="table table-striped"><tr><td>Hostname</td><td>IP</td></tr>';for(var g=0;g<r.net.length;g++){if(i[0].GetIp()==r.net[g].ip){i[0].SetMac(r.net[g].mac);i[0].SetBw(r.net[g].percent,r.net[g].bw*8)}else{h=p/180*Math.PI;color=r.net[g].percent==null?"rgb(0, 0, 255)":r.net[g].percent<1?"rgb(0, 252, 0)":r.net[g].percent<2?"rgb(36, 216, 0)":r.net[g].percent<5?"rgb(72, 180, 0)":r.net[g].percent<10?"rgb(108, 144, 0)":r.net[g].percent<20?"rgb(144, 108, 0)":r.net[g].percent<50?"rgb(180, 72, 0)":r.net[g].percent<70?"rgb(216, 36, 0)":"rgb(252, 0, 0)";l=(a/2+a/2*Math.cos(h)+u.x-a+340)/o.GetScaleConnector();c=(a/2+a/2*Math.sin(h)+u.y-a+340)/o.GetScaleConnector();i[g+1]=new f(r.net[g].ip,r.net[g].mac,r.net[g].os,r.net[g].device,r.net[g].hostname,r.net[g].bw*8,r.net[g].percent,e,l,c,{x:.4+o.GetScaleDevice(),y:.4+o.GetScaleDevice()});i[g+1].Draw();t.path("M"+i[g+1].GetX()+" "+i[g+1].GetY()+"L"+v.x+" "+v.y).attr({stroke:color,"stroke-width":5});p+=d;m+="<tr data-x='"+(parseFloat(l)+o.GetGapX())+"' data-y='"+(parseFloat(c)+o.GetGapY())+'\'><td class="shostname">'+r.net[g].hostname+'</td><td class="sip">'+r.net[g].ip+"</td></tr>"}}i[0].Draw();m+="</table>";$("#search").html(m);$(".shostname, .sip").on("click",function(e){$("circle").remove();var t=Raphael.animation({"20%":{r:20,easing:"bounce"},"40%":{r:40,easing:"bounce"},"60%":{r:20,easing:"bounce"},"80%":{r:40,easing:"bounce"},"100%":{r:30,easing:"bounce"}},5e3);n.circle(parseFloat(e.target.parentNode.getAttribute("data-x"))+50,parseFloat(e.target.parentNode.getAttribute("data-y"))+50,30).attr({fill:"#FF0000"}).animate(t)})}function c(e){$.ajax({type:"post",headers:{"X-CSRFToken":r},url:"/getjson/",success:function(t){h(JSON.parse(t));e(JSON.parse(t))},error:function(){alert("La requête n'a pas abouti")}})}function h(e){$("circle").remove();$("path").remove();$("image").remove();l(e)}function p(){var e={x:0,y:0};var t={x:0,y:0};var n={device:0,connector:1};var i=17;var s=.1;var o=.25;this.Init=function(){$.ajax({type:"post",headers:{"X-CSRFToken":r},data:"",url:"/param/",success:function(e){e=JSON.parse(e);var t=e.success==1?function(){Hydrate(e.obj);return"success"}():function(){return"danger"}();$("#inf").html('<div class="alert alert-'+t+'"><button type="button" class="close" data-dismiss="alert">×</button>'+e.why+"</div>")},error:function(){$("#inf").html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">×</button>La requête n\'a pas pu aboutir</div>')}})};Hydrate=function(e){i=parseFloat(e.move);s=parseFloat(e.zoomd);o=parseFloat(e.zooml)};this.UpdateParam=function(e){Hydrate(e)};this.Reset=function(){e.x=0;e.y=0;n.device=0;n.connector=1};this.GetGapX=function(){return e.x};this.GetGapY=function(){return e.y};this.SetGapX=function(t){t==0?e.x-=i:e.x+=i};this.SetGapY=function(t){t==0?e.y-=i:e.y+=i};this.UpdateGap=function(t){e.x+=t.x;e.y+=t.y};this.GetMouseX=function(){return t.x};this.GetMouseY=function(){return t.y};this.SetMouseX=function(e){t.x=e};this.SetMouseY=function(e){t.y=e};this.GetMove=function(){return i};this.SetMove=function(e){i=e};this.GetScaleDevice=function(){return n.device};this.GetScaleConnector=function(){return n.connector};this.SetScaleDevice=function(e){e==0?n.device-=s:n.device+=s};this.SetScaleConnector=function(e){e==0?n.connector-=o:n.connector+=o}}function v(e){if(e>0){if(o.GetScaleDevice()>-.19&&o.GetScaleConnector()>.49){o.SetScaleDevice(0);o.SetScaleConnector(0);h(u)}}else{if(o.GetScaleDevice()<.3&&o.GetScaleConnector()<1.525){o.SetScaleDevice(1);o.SetScaleConnector(1);h(u)}}}var e=Raphael(document.getElementById("svgDevice"),900,600);var t=Raphael(document.getElementById("svgBw"),900,600);var n=Raphael(document.getElementById("svgSearch"),900,600);var r=a("csrftoken");var i=[];$("#pop").resizable({animate:true}).draggable().tabs();var s=[];var o=new p;o.Init();var u;$("svg").mousewheel(function(e,t,n,r){e.preventDefault();v(t);return false});$("svg").on("mousedown",function(e){e.preventDefault();o.SetMouseX(e.clientX);o.SetMouseY(e.clientY);return false});$("svg").on("mouseup",function(e){e.preventDefault();o.UpdateGap({x:o.GetMouseX()-e.clientX,y:o.GetMouseY()-e.clientY});h(u);return false});$(window).on("keydown",function(e){s.push(e.keyCode);if(s.toString().indexOf("38,38,40,40,37,39,37,39,66,65")>=0){$("body").css({"background-image":"url('/public/img/konami.gif')"});$("#svgDevice").addClass("koko");$("#svgBw").addClass("koko2")}if(e.keyCode>36&&e.keyCode<41||e.keyCode==107||e.keyCode==109){e.preventDefault();e.keyCode==38?o.SetGapY(0):e.keyCode==39?o.SetGapX(0):e.keyCode==40?o.SetGapY(1):e.keyCode==37?o.SetGapX(1):e.keyCode==109?v(-1):e.keyCode==107?v(1):{};h(u);return false}});$(".mapcontroll, #reset").on("click",function(e){if(/mapcontroll/.test(e.target.className)){e.target.id=="m0"?o.SetGapY(1):e.target.id=="m1"?o.SetGapX(1):e.target.id=="m2"?o.SetGapX(0):e.target.id=="m3"?o.SetGapY(0):e.target.id=="m4"?v(1):e.target.id=="m5"?v(-1):{};if(e.target.id!="m4"||e.target.id!="m5")h(u)}else if(e.target.id=="reset"){o.Reset();h(u)}});$("#form0").on("submit",function(e){e.preventDefault();var t=$(this).serialize().replace("%2C",",","gi").split("&");o.UpdateParam({move:parseFloat(t[0].split("=")[1].replace(",",".")),zoomd:parseFloat(t[1].split("=")[1].replace(",",".")),zooml:parseFloat(t[2].split("=")[1].replace(",","."))});return false});window.setInterval(pwned=function(){c(function(e){u=e;var t=0;var n=0;for(var r=0;r<e.net.length;r++){if(e.net[r].bw!=null&&e.net[r].percent!=null){n+=e.net[r].bw*8;t+=e.net[r].percent}}color=t<25?"green":t<50?"yellow":t<75?"orange":"red";$("#cbw").css({width:t*3.5,"background-color":color});$("#binfo").html("<span class='label'>Bande passante totale utilisée : </span><ul><li class='offset1'>"+t.toFixed(2)+" %</li><li class='offset1'>"+n.toFixed(2)+" kb/s</li></ul>")})},3e4);pwned()}())