$(window).load(function(){function p(e){var t=null;if(document.cookie&&document.cookie!=""){var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=jQuery.trim(n[r]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}function v(e,t,n){$(t).html(n);$(e).modal("show")}function m(t){t.preventDefault();$.ajax({type:"post",headers:{"X-CSRFToken":i},data:$(this).serialize(),url:"/ajaxform/"+e+"/",timeout:3e3,success:function(e){e=JSON.parse(e);var t=e.success==1?"success":"danger";$("#info").html('<div class="alert alert-'+t+'"><button type="button" class="close" data-dismiss="alert">×</button>'+e.why+"</div>")},error:function(){$("#info").html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">×</button>La requête n\'a pas pu aboutir</div>')}})}function g(t){t.preventDefault();$.ajax({type:"post",headers:{"X-CSRFToken":i},data:{name:$(this).serialize().split("=")[1],net:JSON.stringify(l)},url:"/ajaxform/"+e+"/",timeout:3e3,success:function(e){e=JSON.parse(e);var t=e.success==1?"success":"danger";$("#info").html('<div class="alert alert-'+t+'"><button type="button" class="close" data-dismiss="alert">×</button>'+e.why+"</div>")},error:function(){$("#info").html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">×</button>La requête n\'a pas pu aboutir</div>')}})}function y(e,t,n,r,s,a,f,l,c,h,p){var e=e;var t=t;var n=n;var r=r;var v=s;var m={p:f,b:a};var g="/public/img/device/"+r+".svg";var l=l;var c=c+u.x;var h=h+u.y;var y={x:55,y:50};var p=p;this.Draw=function(){l.image(g,c,h,100,100).scale(p.x,p.y).mouseover(function(){$("#d").html('<table><tr><td><label class="label">Hostname : </label></td><td>'+v+'</td></tr><tr><td><label class="label">IP : </label></td><td id="aip">'+e+'</td></tr><tr><td><label class="label">MAC : </label></td></td><td>'+t+'</td></tr><tr><td><label class="label">OS : </label></td></td><td><button id="dos" class="btn btn-inverse" type="button">Détection d\'OS</button></td></tr><tr><td><label class="label">Bande passante : </label></td></td><td> '+m.p+"% ("+m.b+" kb/s)</td</tr></table>");$("#dos").on("click",function(){if(o.os==0){o.os=1;$("#inf").html('<div class="container alert alert-info">L\'os finger printing est lancée. Cette action peut prendre un certain temps</div>');$("#os").html();$.ajax({type:"post",headers:{"X-CSRFToken":i},data:{ip:$("#aip").html()},url:"/os/",success:function(e){d=JSON.parse(e);$("#os").html(d.rep);o.os=0;if(d.success=1)$("#inf").html('<div class="container alert alert-info"><button type="button" class="close" data-dismiss="alert">×</button>La fonctionnalité d\'os finger printing est à nouveau disponible</div>');else $("#inf").html('<div class="container alert alert-warning"><button type="button" class="close" data-dismiss="alert">×</button>Un problème est survenu ... <br />Mais la fonctionnalité d\'os finger printing est à nouveau disponible</div>')},error:function(){alert("La requête n'a pas abouti");o.os=0}})}else{$("#inf").html('<div class="container alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>La fonctionnalité d\'os finger printing n\'est pas encore disponible</div>')}})}).drag(function(){return false})};this.GetX=function(){return c+y.x};this.GetY=function(){return h+y.y};this.GetIp=function(){return e};this.GetBw=function(){return m};this.GetHostname=function(){return v};this.SetBw=function(e,t){m.percent=e;m.mega=t};this.SetMac=function(e){t=e}}function b(){}function w(e){var i=60;var o={x:$("#main").width()/2-i,y:$("#main").height()/2-i};var a=500+e.net.length+500*.25;var l=o.x;var c=o.y;var h;var p=0;var d=360/e.net.length+.5;s=[];s[0]=new y(e.gw,"8c:89:a5:a3:ad:1f","Linux","router","Itinet",0,0,t,l/f.connector,c/f.connector,{x:.6+f.device,y:.6+f.device});var v={x:s[0].GetX(),y:s[0].GetY()};var m='<table class="table table-striped"><tr><td>Hostname</td><td>IP</td></tr>';for(var g=0;g<e.net.length;g++){if(s[0].GetIp()==e.net[g].ip){s[0].SetMac(e.net[g].mac);s[0].SetBw(e.net[g].percent,e.net[g].bw*8)}else{h=p/180*Math.PI;color=e.net[g].percent==null?"rgb(0, 0, 255)":e.net[g].percent<1?"rgb(0, 252, 0)":e.net[g].percent<2?"rgb(36, 216, 0)":e.net[g].percent<5?"rgb(72, 180, 0)":e.net[g].percent<10?"rgb(108, 144, 0)":e.net[g].percent<20?"rgb(144, 108, 0)":e.net[g].percent<50?"rgb(180, 72, 0)":e.net[g].percent<70?"rgb(216, 36, 0)":"rgb(252, 0, 0)";l=(a/2+a/2*Math.cos(h)+o.x-a+340)/f.connector;c=(a/2+a/2*Math.sin(h)+o.y-a+340)/f.connector;s[g+1]=new y(e.net[g].ip,e.net[g].mac,e.net[g].os,e.net[g].device,e.net[g].hostname,e.net[g].bw*8,e.net[g].percent,t,l,c,{x:.4+f.device,y:.4+f.device});s[g+1].Draw();n.path("M"+s[g+1].GetX()+" "+s[g+1].GetY()+"L"+v.x+" "+v.y).attr({stroke:color,"stroke-width":5});p+=d;m+="<tr data-x='"+(parseFloat(l)+u.x)+"' data-y='"+(parseFloat(c)+u.y)+'\'><td class="shostname">'+e.net[g].hostname+'</td><td class="sip">'+e.net[g].ip+"</td></tr>"}}s[0].Draw();m+="</table>";$("#search").html(m);$(".shostname, .sip").on("click",function(e){$("circle").remove();var t=Raphael.animation({"20%":{r:20,easing:"bounce"},"40%":{r:40,easing:"bounce"},"60%":{r:20,easing:"bounce"},"80%":{r:40,easing:"bounce"},"100%":{r:30,easing:"bounce"}},5e3);r.circle(parseFloat(e.target.parentNode.getAttribute("data-x"))+50,parseFloat(e.target.parentNode.getAttribute("data-y"))+50,30).attr({fill:"#FF0000"}).animate(t)})}function E(e){$.ajax({type:"post",headers:{"X-CSRFToken":i},url:"/getjson/",timeout:2e4,success:function(t){S(JSON.parse(t));e(JSON.parse(t))},error:function(){alert("La requête n'a pas abouti")}})}function S(e){$("circle").remove();$("path").remove();$("image").remove();w(e)}var e;var t=Raphael(document.getElementById("svgDevice"),900,600);var n=Raphael(document.getElementById("svgBw"),900,600);var r=Raphael(document.getElementById("svgSearch"),900,600);var i=p("csrftoken");var s=[];var o={os:0,sniff:0};var u={x:0,y:0};var a={x:0,y:0,ok:0};var f={device:0,connector:1};var l;var c=17;$("#pop").resizable({animate:true}).draggable().tabs();var h=[];$("a.menu").on("click",function(){e=this.id;$.ajax({type:"post",headers:{"X-CSRFToken":i},data:{id:this.id},url:"/control/",timeout:3e3,success:function(t){if(e>=0&&e<=1||e>=3&&e<=6){v("#option","#dispopt",t);if(e==1){$("#form0").on("submit",g)}else if(e!=6){$("#form0").on("submit",m);if(e==0){$("#form1").on("submit",m)}}}else if(e==2){window.open("/visu/")}},error:function(){alert("La requête n'a pas abouti")}})});$("#fsniff").on("submit",function(e){e.preventDefault();if(o.sniff==0){$("#rsniff").html("");$("#inf").html('<div class="container alert alert-info">L\'écoute est lancée pendant '+$("#stime").val()+" secondes</div>");o.sniff=1;$.ajax({type:"post",headers:{"X-CSRFToken":i},data:{ip:$("#aip").html(),name:$("#sname").val(),time:$("#stime").val()},url:"/sniff/",success:function(e){o.sniff=0;d=JSON.parse(e);if(d.success==1){$("#rsniff").html(d.rep);$("#inf").html('<div class="container alert alert-info"><button type="button" class="close" data-dismiss="alert">×</button>La fonctionnalité d\'écoute est à nouveau disponible</div>')}else $("#inf").html('<div class="container alert alert-warning"><button type="button" class="close" data-dismiss="alert">×</button>Une erreur est survenu ... <br /> Mais la fonctionnalité d\'écoute est à nouveau disponible<br />'+e.rep+"</div>")},error:function(){alert("La requête n'a pas abouti");o.sniff=0}})}else{$("#inf").html('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>La fonctionnalité d\'écoute n\'est pas encore disponible</div>')}return false});window.setInterval(pwned=function(){E(function(e){function i(t){console.log(f);console.log(t);if(t>0){if(f.device>-.19&&f.connector>.49){f.device-=.1;f.connector-=.25;S(e)}}else{if(f.device<.3&&f.connector<1.525){f.device+=.1;f.connector+=.25;S(e)}}}l=e;var t=0;var n=0;for(var r=0;r<e.net.length;r++){if(e.net[r].bw!=null&&e.net[r].percent!=null){n+=e.net[r].bw*8;t+=e.net[r].percent}}color=t<25?"green":t<50?"yellow":t<75?"orange":"red";$("#cbw").css({width:t*3.5,"background-color":color});$("#binfo").html("<span class='label'>Bande passante totale utilisée : </span><ul><li class='offset1'>"+t.toFixed(2)+" %</li><li class='offset1'>"+n.toFixed(2)+" kb/s</li></ul>");$("svg").mousewheel(function(e,t,n,r){e.preventDefault();i(t);return false});$("svg").on("mousedown",function(e){e.preventDefault();a.x=e.clientX;a.y=e.clientY;return false});$("svg").on("mouseup",function(t){t.preventDefault();u.x-=(a.x-t.clientX)*.5;u.y-=(a.y-t.clientY)*.5;S(e);return false});$(document).on("keydown",function(t){h.push(t.keyCode);if(h.toString().indexOf("38,38,40,40,37,39,37,39,66,65")>=0){$("body").css({"background-image":"url('/public/img/konami.gif')"});$("#svgDevice").addClass("koko");$("#svgBw").addClass("koko2")}if(t.keyCode>36&&t.keyCode<41||t.keyCode==107||t.keyCode==109){t.preventDefault();t.keyCode==38?u.y-=c:t.keyCode==39?u.x-=c:t.keyCode==40?u.y+=c:t.keyCode==37?u.x+=c:t.keyCode==109?i(-1):t.keyCode==107?i(1):u.x+=0;S(e);return false}});$(".mapcontroll, #reset").on("click",function(t){if(/mapcontroll/.test(t.target.className)){t.target.id=="m0"?u.y-=c:t.target.id=="m1"?u.x+=c:t.target.id=="m2"?u.x-=c:t.target.id=="m3"?u.y+=c:t.target.id=="m4"?i(1):t.target.id=="m5"?i(-1):u.x+=0;if(t.target.id!="m4"||t.target.id!="m5")S(e)}else if(t.target.id=="reset"){u.x=0;u.y=0;f.device=0;f.connector=1;S(e)}})})},3e4);pwned()}())